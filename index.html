<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NOSSO SORTEIO</title>
  <style>
    :root{--bg:#fbfbfb;--card:#fff;--text:#111;--muted:#666;--gold:#cfa34a;--black:#0b0b0b}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
    header{background:linear-gradient(90deg, rgba(11,11,11,0.98), rgba(22,22,22,0.95));color:white;padding:18px 20px;position:sticky;top:0;z-index:30}
    .container{max-width:1100px;margin:18px auto;padding:0 18px}
    .header-inner{display:flex;align-items:center;gap:18px}
    .brand{font-weight:800;letter-spacing:1px;font-size:20px;color:var(--gold)}
    nav{margin-left:auto}
    nav a{color:#ddd;text-decoration:none;margin-left:16px;font-weight:600}
    nav a:hover{color:white}
    .social a{margin-left:8px;color:#ddd;text-decoration:none}
    main.container{display:grid;grid-template-columns:1fr 360px;gap:20px;margin-top:22px}
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(10,10,10,0.06)}
    h1{margin:0;font-size:28px}
    p.lead{margin:0;color:var(--muted)}
    input[type=number]{width:100%;padding:12px;border-radius:10px;border:1px solid #e6e6e6;font-size:15px}
    .controls{display:flex;gap:10px;align-items:center;margin-top:12px}
    .btn{background:var(--black);color:white;border:none;padding:12px 16px;border-radius:10px;cursor:pointer;font-weight:700}
    .btn.ghost{background:transparent;color:var(--black);border:1px solid #eee}
    .btn.gold{background:var(--gold);color:var(--black)}
    aside .card{position:sticky;top:86px}
    .history{max-height:260px;overflow:auto;margin-top:10px}
    .history-item{padding:8px;border-bottom:1px solid #f3f3f3;font-size:14px}
    .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(0,0,0,0.9),rgba(0,0,0,0.95));z-index:80;transition:opacity 0.3s ease}
    .overlay.active{display:flex;opacity:1}
    .countdown-number{font-size:160px;font-weight:900;color:var(--gold);text-shadow:0 8px 40px rgba(0,0,0,0.6);transition: transform 0.3s ease, opacity 0.3s ease}
    .result-view{display:none;flex-direction:column;align-items:center;gap:16px;padding:40px;text-align:center}
    .result-view.active{display:flex}
    .winner-name{font-size:44px;font-weight:900;color:var(--black)}
    .small-muted{color:var(--muted)}
    footer{max-width:1100px;margin:32px auto 60px;padding:0 18px;color:var(--muted);font-size:13px;text-align:center}
    @media(max-width:940px){main.container{grid-template-columns:1fr} aside .card{position:static;top:auto}}
  </style>
</head>
<body>
  <header>
    <div class="container header-inner">
      <div class="brand">NOSSO SORTEIO</div>
      <nav>
        <a href="#home">InÃ­cio</a>
        <a href="#how">Como Participar</a>
        <a href="#contact">Contato</a>
        <span class="social">
          <a href="https://www.instagram.com/fabriciodesigner_" target="_blank">Instagram</a>
          <a href="https://wa.me/message/SNJ75IX6MKHBP1" target="_blank">WhatsApp</a>
          <a href="https://www.youtube.com/@fabriciodesigner82" target="_blank">YouTube</a>
        </span>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="card hero">
      <div>
        <h1 id="home">Sorteio de NÃºmeros â€” NOSSO SORTEIO</h1>
        <p class="lead">Escolha o intervalo de nÃºmeros que deseja sortear. Clique em <strong>ðŸŽ² SORTEAR AGORA</strong> para iniciar a contagem regressiva suave e revelar o nÃºmero sorteado aleatoriamente em destaque.</p>
      </div>

      <div>
        <label for="min-number">NÃºmero inicial</label>
        <input type="number" id="min-number" value="0">
        <label for="max-number" style="margin-top:8px">NÃºmero final</label>
        <input type="number" id="max-number" value="100">
        <div class="controls">
          <div style="flex:1"></div>
          <button id="sortear" class="btn gold">ðŸŽ² SORTEAR AGORA</button>
        </div>
      </div>

      <div id="result-card" class="card" style="margin-top:12px;display:none">
        <div class="result-view" id="result-view">
          <div style="font-size:18px;color:var(--muted)">Resultado do Ãºltimo sorteio</div>
          <div class="winner-name" id="winner-name">â€”</div>
          <div class="small-muted" id="winner-meta">Sorteado em â€”</div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn" id="download-pdf">Gerar PDF do Resultado</button>
            <button class="btn ghost" id="back-to-list">Voltar</button>
          </div>
        </div>
      </div>
    </section>

    <aside>
      <div class="card" id="sidecard">
        <div style="font-weight:800">HistÃ³rico</div>
        <div class="history" id="history"></div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button id="export-history" class="btn ghost">Exportar histÃ³rico</button>
          <button id="clear-history" class="btn ghost">Limpar</button>
        </div>
      </div>
    </aside>
  </main>

  <div class="overlay" id="overlay">
    <div style="text-align:center">
      <div class="countdown-number" id="countdown">10</div>
      <div style="color:#fff;margin-top:12px;font-weight:600;text-align:center">Preparando sorteio...</div>
    </div>
  </div>

  <footer>
    Â© 2025 - NOSSO SORTEIO. Feito por Fabricio. Use localmente â€” abra o arquivo no navegador.
  </footer>

<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script>
const minEl = document.getElementById('min-number');
const maxEl = document.getElementById('max-number');
const sortearBtn = document.getElementById('sortear');
const overlay = document.getElementById('overlay');
const countdownEl = document.getElementById('countdown');
const resultCard = document.getElementById('result-card');
const resultView = document.getElementById('result-view');
const winnerNameEl = document.getElementById('winner-name');
const winnerMetaEl = document.getElementById('winner-meta');
const backBtn = document.getElementById('back-to-list');
const historyEl = document.getElementById('history');
const downloadPdfBtn = document.getElementById('download-pdf');
const exportHistoryBtn = document.getElementById('export-history');
const clearHistoryBtn = document.getElementById('clear-history');

const HIST_KEY = 'nosso_sorteio_history_v4';
let history = JSON.parse(localStorage.getItem(HIST_KEY) || '[]');

function renderHistory(){
  historyEl.innerHTML = '';
  if(history.length===0){ 
    historyEl.innerHTML = '<div style="color:var(--muted);padding:8px">Nenhum sorteio ainda</div>'; 
    return;
  }
  history.slice().reverse().forEach(item=>{
    const div = document.createElement('div');
    div.className='history-item';
    div.innerHTML = `<strong>${item.winner}</strong><div style="font-size:13px;color:var(--muted)">${item.date} â€” intervalo ${item.min}-${item.max}</div>`;
    historyEl.appendChild(div);
  });
}

function saveHistory(){ 
  localStorage.setItem(HIST_KEY, JSON.stringify(history)); 
  renderHistory(); 
}

function pickRandomNumber(min,max){
  return Math.floor(Math.random()*(max-min+1))+min;
}

async function startCountdownAndPick(){
  const min = parseInt(minEl.value), max = parseInt(maxEl.value);
  if(isNaN(min)||isNaN(max)||max<min){ alert('Intervalo invÃ¡lido'); return; }

  overlay.classList.add('active');

  for(let i=10;i>=0;i--){
    countdownEl.innerText = i;
    await new Promise(r=>setTimeout(r,1000)); // 1 segundo por nÃºmero
  }

  overlay.classList.remove('active');

  const winner = pickRandomNumber(min,max);
  showWinner(winner,min,max);
}

function showWinner(number,min,max){
  winnerNameEl.innerText = number;
  const now = new Date();
  const formatted = now.toLocaleString();
  winnerMetaEl.innerText = `Sorteado em ${formatted} â€” intervalo ${min}-${max}`;
  resultCard.style.display='block';
  resultView.classList.add('active');
  try{ confetti({ particleCount:180, spread:140, origin:{y:0.35} }); }catch(e){}
  history.push({winner:number,date:formatted,min:min,max:max});
  if(history.length>200) history.shift();
  saveHistory();
}

sortearBtn.addEventListener('click', startCountdownAndPick);
backBtn.addEventListener('click', ()=>{ resultView.classList.remove('active'); resultCard.style.display='none'; });

downloadPdfBtn.addEventListener('click', ()=>{
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(18); doc.text('NOSSO SORTEIO',14,22);
  doc.setFontSize(12); doc.text('Certificamos que o sorteio realizado teve o seguinte resultado:',14,38);
  doc.setFontSize(16); doc.text(`NÃºmero sorteado: ${winnerNameEl.innerText}`,14,58);
  doc.setFontSize(12); doc.text(winnerMetaEl.innerText,14,72);
  doc.save(`resultado_sorteio_${winnerNameEl.innerText}.pdf`);
});

exportHistoryBtn.addEventListener('click', ()=>{
  if(history.length===0){ alert('Nenhum sorteio para exportar.'); return; }
  const rows=[['winner','date','min','max']].concat(history.map(h=>[h.winner,h.date,h.min,h.max]));
  const csv = rows.map(r=> r.map(c=>'\"'+String(c).replace(/\"/g,'\"\"')+'\"').join(',')).join('\n');
  const blob = new Blob([csv],{type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='historico_sorteios.csv'; a.click(); URL.revokeObjectURL(url);
});

clearHistoryBtn.addEventListener('click', ()=>{ if(confirm('Limpar histÃ³rico?')){ history=[]; saveHistory(); } });

renderHistory();
</script>
</body>
</html>
